language: node_js
node_js:
- stable
services:
- mongodb
- docker
addons:
  apt:
    packages:
    - sshpass
install:
- yarn
script:
- yarn integration_test
- yarn unit_test
- echo "SESSION_SECRET=$SESSION_SECRET" > .env.secret
- yarn build
- docker build -t copeteam/cope_backend .
after_success:
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
- docker push copeteam/cope_backend
- export SSHPASS=$PASSWORD
- sshpass -e scp docker-compose.yml $USERNAME@$HOST:$DEPLOY_PATH
- sshpass -e ssh $USERNAME@$HOST $DEPLOY_PATH/deploy.sh
env:
  global:
  - secure: quUhyOWLTUVIbddroFi51ntgx7ugnPg7kmuWDouIgpru5gElxQ7Sxca2g9s9u4g1+s9Y3WDAv0ciantObNyhQa7Ci4HYRWtPHA9Uc0SJVCWRc0GxQiLb47JxZ3YAKr5rY1NfoU1rJEF85vq4j4n3fO4KyneAuRt2uH8vns61tHX65ubM5hplQCRZ2WE1xVmChud/2qTkWF+4pjPBs2pfXlP1wN2sz6FhzOEmYmPvjGngo0SHeGeOTNrYV/+qOth8g/SLS9+WgnHUCCDzyQxDO+ULa1LyDg0Cc1jjEj3igYtQkihmdVJBod6RAEk3RTZXD6gi6KrkFswBGBKXY3SQcF8cRqVt+XFYPsuSrF6RfEattF0dPmr5t3BEky2TbHllmJ+voi/wF20tlVPqMrsZ0LelTFjHfXA8F7Lx9bUIZI3Xnq/qS5mj1PTIWvqRVZYkBysqVa7KhOQEa1bhgfGERtBqnBltHkBrujN/DHTFPzRw3hLrKlx5mfMlU23vLAMDxiEfHAKNjhSIbTVs7Nb8Jd4i4H/pWPjo89bz0Lqu9IrOtrSBKprNkYrHahQPRcbqJRuL1tFMYVgILo5/81HBygjBqW58EtRVBl5yfM4bYnEWod6V15yC23xLeme8lGP2MuPCWUkWS8RNJB8Y9b40hO8cBi5RCDbwH6SSV24btpc=
  - secure: by7gqBZ5b31CIAAUETYw6HmbkHkQ1cJAYcJY9S28EfNiE0bVGr1Qgosu1LiIV1JpjLZpC6x6U7rrhCpUIkpUbUwi/rWEzm+ANd/Zx/K2wQLt8ISehjyCkajcY0AgKI21EL/zxp5E4TN8t1GqNALEzQurQlvyK2JX8Bh4lDPyWSQvPr+GkuZ2Mee4t+dGT1zkUbveq2ZOhU1zoDQ8tR1WHqkujj8Y53hUdN7DTyrOFPXvVONAM9+vVin7cqFDggzUg6Gw5xK4HGS1N0c+RUHbKJ3XU16MQolnthC/q81rKOG/Nx04lqrBjqqtWcGSVGjO1GBCFuslR8dIDBUGSOPC1ZWpnYZTm+P8oLaiVeFEo3e6578gy5BvgimpFiPL6Im9Gtu9hUE49Oj/o7lGhCfjWJnBENMzK1bifCNccs9fGYfBGp/7um84/NQdUv2oU9eKs/G8+DuVbUyLu2vzfSbxwHH11jYbSWM+XlqWuaU2TvsaEv34eXR8nQXS06wZmy2my6k3fViuxOE+txMhV2yqTnyeRiNNXREHzZZsPnIpX4ySojRiuarW0hEesYclC//f4uHNejR8rEMRk825yqZ+FIdTMFnlMnjPndlpR1pwhZ1ddJ3vA0gvdYsm6u+KvBy5dpFPybr2gNWNAmL2JSu4Zj8yTRvDBl8RX3Xcy1cXZXg=
  - secure: gQ8B6N7/H3uMIEiC9EQA/V0JVg07HiyF3WxWdiwIavEfz7joXxweGSxDuCKKud7uFnqW+cV1gkT6tqQVGtr4CAenbx+H2p8jB1yjSZKx4aR6e0qazv4TzpEwG8s6YveRgmtDP75zFXa7UQu39qrUkWZuK/QVL01d+Y6/dUalBjQlJfPveCwsdOpmMwrZDIzQ/JyJwSBTtmOcH6HxkBfURo6vtZHjzLuwOpOEAdd4YLFOblWlEHyXzmb1mUTCuvbWYkVAUiaWMTXbl2+2gLYubXc6v1w30tu/mBwvhP6QF22dtH+YkOZNE5pGJ9cydX9vR1bzFih4p9zgwOWifXdDYUpgknDEw7kbhZHTUVHXfXlM/wHFpMEhHgfPECDa33Fq5BK1JEoHcCwT0mtCgmOuWKWQyhAm9O3I43omerX0qZ/YsX0wbNVXQ0Sw/XVvzzY7q2hDEwRD+ET6AnY2aoysc822vpao77uTHzCIRdKbFOfMFqW6Eb18smYSo8h8fmjLOrSfBQWjIAX363u3P8X3qUojrga9dmgHVwd9pQR0Z1mNUdoALUDXWr5pYC3hsR+G2cFjqChJE93NwdmQ/nzx2d07693hHTG2qOqiYN/hOYaZXnw7vtGsH+OEAHbX7uMPpmwcJn+Dp4H/9EYEO/2aDGJMj/eQawMg12DF0PPzo3s=
  #SESSION_SECRET
  - secure: QCffbk0wJ1LBdNo+2ebWbkDOV/DywXv/vkDHN7tQzQnkEje2ooJN8dXHN+6KhcmgEanAPdEOSmrfFX+3DwopRdwv49MKQdEmEWNTnwlZ9Ku0BTO6XDN4xdUfBBHt+7gfoPlIfZz1/Z1IvNHCT9rS7lZ6r0JbWAlqdYwN8OVx7sy3Du4Dk8Tq6gR/gXa81XQJ0dXx3d42u+4ETvat60XCjBtDHovpbIY5TgTcG4r357q0MPwsgGvbHdA/nULXLjidJ8SZfSsgtNFAbCUqpwKVNGNEA/yh1Lt2EgeBaqG8F1VO+flcM5GJv9ANULGgNGhwtwOzGu9kMPOTRmf/n3b1FimdIT2sO/2sMb5X8hBs7wG6WmPtI2hh4BP+pkfWqXyhwzOm+73nbEVTuoX+jAo2eapRYBBA7JzqbKnIrGM0UhnxGhK9TZE6PPnxjY0RwQc/RG8dIDbwRy+96LMesrCb2U0U9sx+EHfz1V9bjd/OwU8BNb4Vhg5f5BTR1JiBH7zc4S/MxuwdBsl0eTaz7WDyBIpxeuc6/XyXUV+g+2A52mCU4eRMj3IpaGETmnMkA6TInmWsdYtFHMrjujIHKhqiyQlro9qxCztgk1it0pxnzq4Iki3Ca1ED/zPS3KeT9zRD5Ghga3poclji0oU9XCTYWzXfhaXVJ5ce4n9BqeejyXY=
  #HOST
  - secure: PWqk040ESbO7LpDZo2i8JNxa1onesg9E39DtIMjRfvNgHXjEZXcmJYaRxMWmk3Mq6BmpI1XqzIynCWcnlnuFgWSHlhBP3LmJ6Bn306I/FCTZjuZYcLzfXJI5hZPu5f6Pj9EbaF7JIwuPgY0FJgP2jGVBB0YAtVU/BjJmU8YZGbmF+jnBlloYqgNlOtP+X1jGYcCr+wZ5ZBinepbAa/az3EXWnLzcT3J7V7C3M4IaXgtsAk3TX/I+j0RzzNVphbKBFDxb1bDX3ASwGV+IHRPOIf2M5LIda44KK4aMUiSyEsaH4cEmYoQ5ng7QLzpXMhMcgUPYPSR3L+uyO5rEXL8FWypBH7B9PJu4Ljzatf7sQAN1GJhy1otpNzPIQYa7inmaa+nifD6N918yRer546PcTUkvEeErlaMVVeb48xD+oGf22PzrGgbn8otu7cEMDCXmOuDc57gf1zrdtpkyDkeowqRlRx3QkawN5/aKSBMj4iCCcOT+yfdXSt3Yf1z0G8r/Y4C5/i4f+zRz5Pk8iZMslWBsWBYEPn1KorbSQEe6XbBq5Khl7GsJneNE51CZrSEd7InBK+T1VoEwWLgXDk6AcbenPPY/MPXSzwyn650nEhMBL9aH4DL0/W+lLmim6M4jETHBRR/xLwU+2P5+Fzn05Gw9PlX4q2fE030TOg8hcgs=
  #USERNAME
  - secure: jVoplpu6aEjR+6cJLJkHyqBq0sz8kmFh2qdgTXEaCD4TnxpjHE3JXeFU0rvi8Bp366rvi7QGxu/yrfDfDnxx6D6Am4OSxzuF5wEGXven+SGtVPTxyt1OxkPGo/1XQfmpIg6KTrsYDj2mH2gZsp2EQnR5Jajg1Nk63j3OGshOQaKoKrWiHnSKJrCmHDRkYvHPqQDDlgtpp/zdvQSSOe1jlBn4jqENfD2FZ4pRpx0aQ8rBPNPFsQ/4kN1BH+pd34BElkPpFUg9Jp2kKGmzaOR92+6Ems4v47HZc19oV/y4kPnrSBTy9SJFrwjODCDxTwz48bXbu6XQRSNHniVJF057yx1V9GE7ppuCmFiBaTjBL6X33CKPQAxToC/sk4I7ImOZjhAa62zp4qmcnWYrgjDsHccuIA4/YqulIozgMdDWA/ASGrrx3YCU2CKtNZXd78mrIYFjtpx4dH68Stgq5PzhqsyxrxmHqJD6Ej6dZymPzrdnuyFVKOTQ2yYAQp0YI2iq4z2domZaFqnEMKwNkvj8XNIrkNvopMcXmyp9l6E9D/ewRqzrCNgNOfyKpb9I5ITx/ACCYvol6Fn0IHbqI/cJr327WjkMQrxjKRbOx/aw9dsMk6rMs9m0JHjSsgNUdzUiD9ZcAIdZyrSd/XgJkUDlXX49swbwCYb0YTiKtUOG4B4=
  #PASSWORD
  - secure: nMCv3ivGSi5lR4KzAjRPfmbXeHBhSx4YX84MV2G7xh9K73BcyTfDLLSF7iFBr6p7H9dX1bo5W1hWJh8yOfLsopDNyuRxFMIbpJJ+7HKbTzEuvwYG/EADApArM03058UfE8/Kfkx1J4jDOqfZCT4sGlr0a14knPS/dMuVQPFWSP/CLJD++VO6k9Tg3cyfif4BG/gLWCKXWA0qrtRtooNyfkaLPJG9jX9mSsJQb+QI6XdOUgoJXorIIKOa80LJSFbGXufb3FNYCg0PTxGn+TvQYuHWEwHxQHQrUOyQt7UtDjqK3Kgsy5iIVUGL6ObOzZS67kYgsC/TSWmEvyNlNj+NP+L9jwJwZkuFrd0nLfPDUspoHbxJsaGnWvsNFR+yBpp3kQxkQ7mhBozlxr2+lEZm2lktrYot0ndEgaPr1MaLlHU901O+RYdwGIvDwxHyxS7sxYANMXbyzOFtVF5jsXD/MG5QwP3clWJ489sfy6zhddfoHMr/eEk/Z7VHX4gH2vkvusoyo0tZWAEAtoS3B44JBv9CzDdRcOHuRBRH5iXU8ZxvFYwQ1qs17NmhBWOXhyhZzOnAMA9//mM78rSog1+7Y5ZOUjZiB0YmenjpUDmh0fw/ZEjM6diI/S3nzLSXtmc6jP4drspnIVbIpEpZi0u15betjxjdMg4QLnYsQAeAcAA=
  #DEPLOY_PATH
  - secure: dgycz5DGfumwz7X2pFtzqLHppN92bWXrhGCp2S0kh8RpyHodYzhAgTn8+oP1vW/lRJrQUZHseUO25kENE/QLypwLTTxM0sI6HEfeMQ7VBoezLwSFWgCmcpi9dxz/fnTjkZcMnCbGVybGIvnpHJMlsNDKkp8TAsdpjexwhx7kVYCd7EfaLWKovbQRgn15xnTHDU9OHPg3j2tRjLP2wFXmugLSb40oB4CTr/iBAzTIXCoBPnB9D2DjdiNiWJsh1+Owci1x57iO2Vq0DtmxSmUDw+nl3mc0XUyYHujkI+yzzndXLSg81XRkZlRnF8QlMko9VvI7S0qDdlrM73LHFrd6BgPrU2XOn9VFLsW/CEvsRdLUfoYH+AFCDWBd+NNwnQha41x7nCXOKjbKv8g1Ok55YPW8cFrStFWSKDP477h+y9w4n5fpraJ8VVZuj7ny0ya5xpLHs8VcTQn9fTBXJ6amnbKr2fuUXy6nEmlY/T+iiFht9fZH8AIP8ZRZt/kD0IGirCA83SBHZeuQHM7+4zv/nI5vyCxDERx7XBXBr+JuvzRNPKy+jlcm9zdiYDoWrRDOv5J0icVVl3zvt/4ezQDk8gANx/QE1VPFJpUGzKqb+P2/oDj95X/bjVSLhm65vZ8ekF9ZYk4YbGUQOLOvNTOF0AAhHZ2JbxS1PNy/t68/ok8=



